<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Topic 11 Lasso &amp; Logistic Regression | STAT 253: Statistical Machine Learning</title>
  <meta name="description" content="This is the class website for Statistical Machine Learning at Macalester College." />
  <meta name="generator" content="bookdown 0.32 and GitBook 2.6.7" />

  <meta property="og:title" content="Topic 11 Lasso &amp; Logistic Regression | STAT 253: Statistical Machine Learning" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="This is the class website for Statistical Machine Learning at Macalester College." />
  <meta name="github-repo" content="JamesNormington/253_spring_2023" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Topic 11 Lasso &amp; Logistic Regression | STAT 253: Statistical Machine Learning" />
  
  <meta name="twitter:description" content="This is the class website for Statistical Machine Learning at Macalester College." />
  




  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="logistic-regression.html"/>
<link rel="next" href="decision-trees.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="custom_styles.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href = "./">STAT 253: Statistical Machine Learning</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Welcome!</a></li>
<li class="chapter" data-level="" data-path="schedule-syllabus.html"><a href="schedule-syllabus.html"><i class="fa fa-check"></i>Schedule &amp; Syllabus</a></li>
<li class="chapter" data-level="" data-path="learning-objectives.html"><a href="learning-objectives.html"><i class="fa fa-check"></i>Learning Objectives</a></li>
<li class="chapter" data-level="" data-path="r-and-rstudio-setup.html"><a href="r-and-rstudio-setup.html"><i class="fa fa-check"></i>R and RStudio Setup</a>
<ul>
<li class="chapter" data-level="" data-path="r-and-rstudio-setup.html"><a href="r-and-rstudio-setup.html#troubleshooting"><i class="fa fa-check"></i>Troubleshooting</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="introductions.html"><a href="introductions.html"><i class="fa fa-check"></i><b>1</b> Introductions</a>
<ul>
<li class="chapter" data-level="" data-path="introductions.html"><a href="introductions.html#envisioning-a-community-of-learners"><i class="fa fa-check"></i>Envisioning a Community of Learners</a></li>
<li class="chapter" data-level="" data-path="introductions.html"><a href="introductions.html#explorations"><i class="fa fa-check"></i>Explorations</a></li>
</ul></li>
<li class="part"><span><b>I Regression: Evaluation</b></span></li>
<li class="chapter" data-level="2" data-path="evaluating-regression-models.html"><a href="evaluating-regression-models.html"><i class="fa fa-check"></i><b>2</b> Evaluating Regression Models</a>
<ul>
<li class="chapter" data-level="" data-path="evaluating-regression-models.html"><a href="evaluating-regression-models.html#learning-goals"><i class="fa fa-check"></i>Learning Goals</a></li>
<li class="chapter" data-level="" data-path="evaluating-regression-models.html"><a href="evaluating-regression-models.html#exercises"><i class="fa fa-check"></i>Exercises</a>
<ul>
<li class="chapter" data-level="" data-path="evaluating-regression-models.html"><a href="evaluating-regression-models.html#context"><i class="fa fa-check"></i>Context</a></li>
<li class="chapter" data-level="" data-path="evaluating-regression-models.html"><a href="evaluating-regression-models.html#class-investigations"><i class="fa fa-check"></i>Class investigations</a></li>
<li class="chapter" data-level="" data-path="evaluating-regression-models.html"><a href="evaluating-regression-models.html#exercise-1"><i class="fa fa-check"></i>Exercise 1</a></li>
<li class="chapter" data-level="" data-path="evaluating-regression-models.html"><a href="evaluating-regression-models.html#exercise-2"><i class="fa fa-check"></i>Exercise 2</a></li>
<li class="chapter" data-level="" data-path="evaluating-regression-models.html"><a href="evaluating-regression-models.html#exercise-3"><i class="fa fa-check"></i>Exercise 3</a></li>
<li class="chapter" data-level="" data-path="evaluating-regression-models.html"><a href="evaluating-regression-models.html#exercise-4"><i class="fa fa-check"></i>Exercise 4</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="overfitting.html"><a href="overfitting.html"><i class="fa fa-check"></i><b>3</b> Overfitting</a>
<ul>
<li class="chapter" data-level="" data-path="overfitting.html"><a href="overfitting.html#learning-goals-1"><i class="fa fa-check"></i>Learning Goals</a></li>
<li class="chapter" data-level="" data-path="overfitting.html"><a href="overfitting.html#the-tidymodels-package"><i class="fa fa-check"></i>The <code>tidymodels</code> package</a></li>
<li class="chapter" data-level="" data-path="overfitting.html"><a href="overfitting.html#exercises-1"><i class="fa fa-check"></i>Exercises</a>
<ul>
<li class="chapter" data-level="" data-path="overfitting.html"><a href="overfitting.html#context-1"><i class="fa fa-check"></i>Context</a></li>
<li class="chapter" data-level="" data-path="overfitting.html"><a href="overfitting.html#exercise-1-5-models"><i class="fa fa-check"></i>Exercise 1: 5 models</a></li>
<li class="chapter" data-level="" data-path="overfitting.html"><a href="overfitting.html#exercise-2-evaluating-the-test-data"><i class="fa fa-check"></i>Exercise 2: Evaluating the Test Data</a></li>
<li class="chapter" data-level="" data-path="overfitting.html"><a href="overfitting.html#exercise-3-overfitting"><i class="fa fa-check"></i>Exercise 3: Overfitting</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="cross-validation.html"><a href="cross-validation.html"><i class="fa fa-check"></i><b>4</b> Cross-validation</a>
<ul>
<li class="chapter" data-level="" data-path="cross-validation.html"><a href="cross-validation.html#learning-goals-2"><i class="fa fa-check"></i>Learning Goals</a></li>
<li class="chapter" data-level="" data-path="cross-validation.html"><a href="cross-validation.html#exercises-2"><i class="fa fa-check"></i>Exercises</a>
<ul>
<li class="chapter" data-level="" data-path="cross-validation.html"><a href="cross-validation.html#context-2"><i class="fa fa-check"></i>Context</a></li>
<li class="chapter" data-level="" data-path="cross-validation.html"><a href="cross-validation.html#exercise-1-cross-validation-in-concept"><i class="fa fa-check"></i>Exercise 1: Cross-validation in Concept</a></li>
<li class="chapter" data-level="" data-path="cross-validation.html"><a href="cross-validation.html#exercise-2-cross-validation-with-tidymodels"><i class="fa fa-check"></i>Exercise 2: Cross-validation with <code>tidymodels</code></a></li>
<li class="chapter" data-level="" data-path="cross-validation.html"><a href="cross-validation.html#exercise-3-looking-at-the-evaluation-metrics"><i class="fa fa-check"></i>Exercise 3: Looking at the evaluation metrics</a></li>
<li class="chapter" data-level="" data-path="cross-validation.html"><a href="cross-validation.html#exercise-4-practical-issues-choosing-k"><i class="fa fa-check"></i>Exercise 4: Practical issues: choosing <span class="math inline">\(k\)</span></a></li>
<li class="chapter" data-level="" data-path="cross-validation.html"><a href="cross-validation.html#digging-deeper"><i class="fa fa-check"></i>Digging deeper</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>II Regression: Building Models</b></span></li>
<li class="chapter" data-level="5" data-path="variable-subset-selection.html"><a href="variable-subset-selection.html"><i class="fa fa-check"></i><b>5</b> Variable Subset Selection</a>
<ul>
<li class="chapter" data-level="" data-path="variable-subset-selection.html"><a href="variable-subset-selection.html#learning-goals-3"><i class="fa fa-check"></i>Learning Goals</a></li>
<li class="chapter" data-level="" data-path="variable-subset-selection.html"><a href="variable-subset-selection.html#exercises-3"><i class="fa fa-check"></i>Exercises</a>
<ul>
<li class="chapter" data-level="" data-path="variable-subset-selection.html"><a href="variable-subset-selection.html#exercise-1-backward-stepwise-selection-by-hand"><i class="fa fa-check"></i>Exercise 1: Backward stepwise selection: by hand</a></li>
<li class="chapter" data-level="" data-path="variable-subset-selection.html"><a href="variable-subset-selection.html#exercise-2-interpreting-the-results"><i class="fa fa-check"></i>Exercise 2: Interpreting the results</a></li>
<li class="chapter" data-level="" data-path="variable-subset-selection.html"><a href="variable-subset-selection.html#exercise-3-planning-forward-selection-using-cv"><i class="fa fa-check"></i>Exercise 3: Planning forward selection using CV</a></li>
<li class="chapter" data-level="" data-path="variable-subset-selection.html"><a href="variable-subset-selection.html#exercise-4-stepwise-selection-in-caret"><i class="fa fa-check"></i>Exercise 4: Stepwise selection in <code>caret</code></a></li>
<li class="chapter" data-level="" data-path="variable-subset-selection.html"><a href="variable-subset-selection.html#exercise-5-exploring-the-results"><i class="fa fa-check"></i>Exercise 5: Exploring the results</a></li>
<li class="chapter" data-level="" data-path="variable-subset-selection.html"><a href="variable-subset-selection.html#digging-deeper-1"><i class="fa fa-check"></i>Digging deeper</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="lasso-shrinkageregularization.html"><a href="lasso-shrinkageregularization.html"><i class="fa fa-check"></i><b>6</b> LASSO: Shrinkage/Regularization</a>
<ul>
<li class="chapter" data-level="" data-path="lasso-shrinkageregularization.html"><a href="lasso-shrinkageregularization.html#learning-goals-4"><i class="fa fa-check"></i>Learning Goals</a></li>
<li class="chapter" data-level="" data-path="lasso-shrinkageregularization.html"><a href="lasso-shrinkageregularization.html#lasso-models-in-tidymodels"><i class="fa fa-check"></i>LASSO models in <code>tidymodels</code></a></li>
<li class="chapter" data-level="" data-path="lasso-shrinkageregularization.html"><a href="lasso-shrinkageregularization.html#exercises-4"><i class="fa fa-check"></i>Exercises</a>
<ul>
<li class="chapter" data-level="" data-path="lasso-shrinkageregularization.html"><a href="lasso-shrinkageregularization.html#exercise-1-a-least-squares-model"><i class="fa fa-check"></i>Exercise 1: A least squares model</a></li>
<li class="chapter" data-level="" data-path="lasso-shrinkageregularization.html"><a href="lasso-shrinkageregularization.html#exercise-2-fitting-a-lasso-model-in-tidymodels"><i class="fa fa-check"></i>Exercise 2: Fitting a LASSO model in <code>tidymodels</code></a></li>
<li class="chapter" data-level="" data-path="lasso-shrinkageregularization.html"><a href="lasso-shrinkageregularization.html#exercise-3-examining-output-plot-of-coefficient-paths"><i class="fa fa-check"></i>Exercise 3: Examining output: plot of coefficient paths</a></li>
<li class="chapter" data-level="" data-path="lasso-shrinkageregularization.html"><a href="lasso-shrinkageregularization.html#exercise-4-examining-and-evaluating-the-best-lasso-model."><i class="fa fa-check"></i>Exercise 4: Examining and evaluating the best LASSO model.</a></li>
<li class="chapter" data-level="" data-path="lasso-shrinkageregularization.html"><a href="lasso-shrinkageregularization.html#digging-deeper-2"><i class="fa fa-check"></i>Digging deeper</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>III Regression: Building Flexible Models</b></span></li>
<li class="chapter" data-level="7" data-path="knn-regression-and-the-bias-variance-tradeoff.html"><a href="knn-regression-and-the-bias-variance-tradeoff.html"><i class="fa fa-check"></i><b>7</b> KNN Regression and the Bias-Variance Tradeoff</a>
<ul>
<li class="chapter" data-level="" data-path="knn-regression-and-the-bias-variance-tradeoff.html"><a href="knn-regression-and-the-bias-variance-tradeoff.html#learning-goals-5"><i class="fa fa-check"></i>Learning Goals</a></li>
<li class="chapter" data-level="" data-path="knn-regression-and-the-bias-variance-tradeoff.html"><a href="knn-regression-and-the-bias-variance-tradeoff.html#knn-models-in-tidymodels"><i class="fa fa-check"></i>KNN models in <code>tidymodels</code></a></li>
<li class="chapter" data-level="" data-path="knn-regression-and-the-bias-variance-tradeoff.html"><a href="knn-regression-and-the-bias-variance-tradeoff.html#exercises-5"><i class="fa fa-check"></i>Exercises</a>
<ul>
<li class="chapter" data-level="" data-path="knn-regression-and-the-bias-variance-tradeoff.html"><a href="knn-regression-and-the-bias-variance-tradeoff.html#exercise-1-bias-variance-tradeoff-warmup"><i class="fa fa-check"></i>Exercise 1: Bias-variance tradeoff warmup</a></li>
<li class="chapter" data-level="" data-path="knn-regression-and-the-bias-variance-tradeoff.html"><a href="knn-regression-and-the-bias-variance-tradeoff.html#exercise-2-impact-of-distance-metric"><i class="fa fa-check"></i>Exercise 2: Impact of distance metric</a></li>
<li class="chapter" data-level="" data-path="knn-regression-and-the-bias-variance-tradeoff.html"><a href="knn-regression-and-the-bias-variance-tradeoff.html#exercise-3-implementing-knn-in-tidymodels"><i class="fa fa-check"></i>Exercise 3: Implementing KNN in <code>tidymodels</code></a></li>
<li class="chapter" data-level="" data-path="knn-regression-and-the-bias-variance-tradeoff.html"><a href="knn-regression-and-the-bias-variance-tradeoff.html#exercise-4-inspecting-the-results"><i class="fa fa-check"></i>Exercise 4: Inspecting the results</a></li>
<li class="chapter" data-level="" data-path="knn-regression-and-the-bias-variance-tradeoff.html"><a href="knn-regression-and-the-bias-variance-tradeoff.html#exercise-5-curse-of-dimensionality"><i class="fa fa-check"></i>Exercise 5: Curse of dimensionality</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="splines.html"><a href="splines.html"><i class="fa fa-check"></i><b>8</b> Splines</a>
<ul>
<li class="chapter" data-level="" data-path="splines.html"><a href="splines.html#learning-goals-6"><i class="fa fa-check"></i>Learning Goals</a></li>
<li class="chapter" data-level="" data-path="splines.html"><a href="splines.html#splines-in-tidymodels"><i class="fa fa-check"></i>Splines in <code>tidymodels</code></a></li>
<li class="chapter" data-level="" data-path="splines.html"><a href="splines.html#exercises-6"><i class="fa fa-check"></i>Exercises</a>
<ul>
<li class="chapter" data-level="" data-path="splines.html"><a href="splines.html#exercise-1-evaluating-a-fully-linear-model"><i class="fa fa-check"></i>Exercise 1: Evaluating a fully linear model</a></li>
<li class="chapter" data-level="" data-path="splines.html"><a href="splines.html#exercise-2-evaluating-a-spline-model"><i class="fa fa-check"></i>Exercise 2: Evaluating a spline model</a></li>
<li class="chapter" data-level="" data-path="splines.html"><a href="splines.html#extra-variable-scaling"><i class="fa fa-check"></i>Extra! Variable scaling</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="local-regression-gams.html"><a href="local-regression-gams.html"><i class="fa fa-check"></i><b>9</b> Local Regression &amp; GAMs</a>
<ul>
<li class="chapter" data-level="" data-path="local-regression-gams.html"><a href="local-regression-gams.html#learning-goals-7"><i class="fa fa-check"></i>Learning Goals</a></li>
<li class="chapter" data-level="9.1" data-path="local-regression-gams.html"><a href="local-regression-gams.html#gams"><i class="fa fa-check"></i><b>9.1</b> GAMs</a></li>
<li class="chapter" data-level="9.2" data-path="local-regression-gams.html"><a href="local-regression-gams.html#gams---options-for-fitting"><i class="fa fa-check"></i><b>9.2</b> GAMs - Options for Fitting</a></li>
<li class="chapter" data-level="" data-path="local-regression-gams.html"><a href="local-regression-gams.html#gams-in-tidymodels"><i class="fa fa-check"></i>GAMs in <code>tidymodels</code></a></li>
<li class="chapter" data-level="" data-path="local-regression-gams.html"><a href="local-regression-gams.html#exercises-7"><i class="fa fa-check"></i>Exercises</a>
<ul>
<li class="chapter" data-level="" data-path="local-regression-gams.html"><a href="local-regression-gams.html#exercise-1-conceptual-warmup"><i class="fa fa-check"></i>Exercise 1: Conceptual warmup</a></li>
<li class="chapter" data-level="" data-path="local-regression-gams.html"><a href="local-regression-gams.html#exercise-2-using-loess"><i class="fa fa-check"></i>Exercise 2: Using LOESS</a></li>
<li class="chapter" data-level="" data-path="local-regression-gams.html"><a href="local-regression-gams.html#exercise-3-building-a-gam-in-tidymodels"><i class="fa fa-check"></i>Exercise 3: Building a GAM in <code>tidymodels</code></a></li>
<li class="chapter" data-level="" data-path="local-regression-gams.html"><a href="local-regression-gams.html#exercise-4-adjusting-the-best-gam"><i class="fa fa-check"></i>Exercise 4: Adjusting the “best” GAM</a></li>
<li class="chapter" data-level="" data-path="local-regression-gams.html"><a href="local-regression-gams.html#exercise-5-gam-with-recipes"><i class="fa fa-check"></i>Exercise 5: GAM with recipes</a></li>
<li class="chapter" data-level="" data-path="local-regression-gams.html"><a href="local-regression-gams.html#exercise-6-putting-a-bow-on-regression"><i class="fa fa-check"></i>Exercise 6: putting a bow on regression</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>IV Classification</b></span></li>
<li class="chapter" data-level="10" data-path="logistic-regression.html"><a href="logistic-regression.html"><i class="fa fa-check"></i><b>10</b> Logistic Regression</a>
<ul>
<li class="chapter" data-level="" data-path="logistic-regression.html"><a href="logistic-regression.html#learning-goals-8"><i class="fa fa-check"></i>Learning Goals</a></li>
<li class="chapter" data-level="" data-path="logistic-regression.html"><a href="logistic-regression.html#logistic-regression-in-tidymodels"><i class="fa fa-check"></i>Logistic regression in <code>tidymodels</code></a></li>
<li class="chapter" data-level="" data-path="logistic-regression.html"><a href="logistic-regression.html#exercises-8"><i class="fa fa-check"></i>Exercises</a>
<ul>
<li class="chapter" data-level="" data-path="logistic-regression.html"><a href="logistic-regression.html#context-and-data"><i class="fa fa-check"></i>Context and Data</a></li>
<li class="chapter" data-level="" data-path="logistic-regression.html"><a href="logistic-regression.html#exercise-1-visualization-warmup"><i class="fa fa-check"></i>Exercise 1: Visualization warmup</a></li>
<li class="chapter" data-level="" data-path="logistic-regression.html"><a href="logistic-regression.html#exercise-2-implementing-logistic-regression-in-tidymodels"><i class="fa fa-check"></i>Exercise 2: Implementing logistic regression in <code>tidymodels</code></a></li>
<li class="chapter" data-level="" data-path="logistic-regression.html"><a href="logistic-regression.html#exercise-3-interpreting-the-model"><i class="fa fa-check"></i>Exercise 3: Interpreting the model</a></li>
<li class="chapter" data-level="" data-path="logistic-regression.html"><a href="logistic-regression.html#exercise-4-making-predictions"><i class="fa fa-check"></i>Exercise 4: Making predictions</a></li>
<li class="chapter" data-level="10.0.1" data-path="logistic-regression.html"><a href="logistic-regression.html#exercise-5-evaluate-the-model"><i class="fa fa-check"></i><b>10.0.1</b> Exercise 5: Evaluate the model</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="11" data-path="lasso-logistic-regression.html"><a href="lasso-logistic-regression.html"><i class="fa fa-check"></i><b>11</b> Lasso &amp; Logistic Regression</a>
<ul>
<li class="chapter" data-level="" data-path="lasso-logistic-regression.html"><a href="lasso-logistic-regression.html#learning-goals-9"><i class="fa fa-check"></i>Learning Goals</a></li>
<li class="chapter" data-level="" data-path="lasso-logistic-regression.html"><a href="lasso-logistic-regression.html#lasso-for-logistic-regression-in-tidymodels"><i class="fa fa-check"></i>LASSO for logistic regression in <code>tidymodels</code></a></li>
<li class="chapter" data-level="" data-path="lasso-logistic-regression.html"><a href="lasso-logistic-regression.html#exercises-9"><i class="fa fa-check"></i>Exercises</a>
<ul>
<li class="chapter" data-level="" data-path="lasso-logistic-regression.html"><a href="lasso-logistic-regression.html#context-3"><i class="fa fa-check"></i>Context</a></li>
<li class="chapter" data-level="" data-path="lasso-logistic-regression.html"><a href="lasso-logistic-regression.html#exercise-1-conceptual-warmup-1"><i class="fa fa-check"></i>Exercise 1: Conceptual warmup</a></li>
<li class="chapter" data-level="" data-path="lasso-logistic-regression.html"><a href="lasso-logistic-regression.html#exercise-2-implementing-lasso-logistic-regression-in-tidymodels"><i class="fa fa-check"></i>Exercise 2: Implementing LASSO logistic regression in <code>tidymodels</code></a></li>
<li class="chapter" data-level="" data-path="lasso-logistic-regression.html"><a href="lasso-logistic-regression.html#exercise-3-inspecting-the-model"><i class="fa fa-check"></i>Exercise 3: Inspecting the model</a></li>
<li class="chapter" data-level="" data-path="lasso-logistic-regression.html"><a href="lasso-logistic-regression.html#exercise-4-interpreting-evaluation-metrics"><i class="fa fa-check"></i>Exercise 4: Interpreting evaluation metrics</a></li>
<li class="chapter" data-level="" data-path="lasso-logistic-regression.html"><a href="lasso-logistic-regression.html#exercise-5-using-the-final-model-choosing-a-threshold"><i class="fa fa-check"></i>Exercise 5: Using the final model (choosing a threshold)</a></li>
<li class="chapter" data-level="" data-path="lasso-logistic-regression.html"><a href="lasso-logistic-regression.html#exercise-6-algorithmic-understanding-for-evaluation-metrics"><i class="fa fa-check"></i>Exercise 6: Algorithmic understanding for evaluation metrics</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="12" data-path="decision-trees.html"><a href="decision-trees.html"><i class="fa fa-check"></i><b>12</b> Decision Trees</a>
<ul>
<li class="chapter" data-level="" data-path="decision-trees.html"><a href="decision-trees.html#learning-goals-10"><i class="fa fa-check"></i>Learning Goals</a></li>
<li class="chapter" data-level="" data-path="decision-trees.html"><a href="decision-trees.html#trees-in-tidymodels"><i class="fa fa-check"></i>Trees in <code>tidymodels</code></a></li>
<li class="chapter" data-level="" data-path="decision-trees.html"><a href="decision-trees.html#exercises-part-1"><i class="fa fa-check"></i>Exercises Part 1</a>
<ul>
<li class="chapter" data-level="" data-path="decision-trees.html"><a href="decision-trees.html#context-4"><i class="fa fa-check"></i>Context</a></li>
<li class="chapter" data-level="" data-path="decision-trees.html"><a href="decision-trees.html#exercise-1-core-theme-parametricnonparametric"><i class="fa fa-check"></i>Exercise 1: Core theme: parametric/nonparametric</a></li>
<li class="chapter" data-level="" data-path="decision-trees.html"><a href="decision-trees.html#exercise-2-core-theme-tuning-parameters-and-the-bvt"><i class="fa fa-check"></i>Exercise 2: Core theme: Tuning parameters and the BVT</a></li>
<li class="chapter" data-level="" data-path="decision-trees.html"><a href="decision-trees.html#exercise-3-building-trees-in-tidymodels"><i class="fa fa-check"></i>Exercise 3: Building trees in <code>tidymodels</code></a></li>
<li class="chapter" data-level="" data-path="decision-trees.html"><a href="decision-trees.html#exercise-4-visualizing-trees"><i class="fa fa-check"></i>Exercise 4: Visualizing trees</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="decision-trees.html"><a href="decision-trees.html#exercises-part-2"><i class="fa fa-check"></i>Exercises Part 2</a>
<ul>
<li class="chapter" data-level="" data-path="decision-trees.html"><a href="decision-trees.html#exercise-5-predictions-from-trees"><i class="fa fa-check"></i>Exercise 5: Predictions from Trees</a></li>
<li class="chapter" data-level="" data-path="decision-trees.html"><a href="decision-trees.html#exercise-6-variable-importance-in-trees"><i class="fa fa-check"></i>Exercise 6: Variable importance in trees</a></li>
<li class="chapter" data-level="" data-path="decision-trees.html"><a href="decision-trees.html#exercise-7-regression-trees"><i class="fa fa-check"></i>Exercise 7: REGRESSION trees?!</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="13" data-path="bagging-and-random-forests.html"><a href="bagging-and-random-forests.html"><i class="fa fa-check"></i><b>13</b> Bagging and Random Forests</a>
<ul>
<li class="chapter" data-level="" data-path="bagging-and-random-forests.html"><a href="bagging-and-random-forests.html#learning-goals-11"><i class="fa fa-check"></i>Learning Goals</a></li>
<li class="chapter" data-level="" data-path="bagging-and-random-forests.html"><a href="bagging-and-random-forests.html#exercises-10"><i class="fa fa-check"></i>Exercises</a>
<ul>
<li class="chapter" data-level="" data-path="bagging-and-random-forests.html"><a href="bagging-and-random-forests.html#exercise-1-bagging-bootstrap-aggregation"><i class="fa fa-check"></i>Exercise 1: Bagging: <em>B</em>ootstrap <em>AGG</em>regation</a></li>
<li class="chapter" data-level="" data-path="bagging-and-random-forests.html"><a href="bagging-and-random-forests.html#exercise-2-random-forest-groundwork"><i class="fa fa-check"></i>Exercise 2: Random forest groundwork</a></li>
<li class="chapter" data-level="" data-path="bagging-and-random-forests.html"><a href="bagging-and-random-forests.html#exercise-3-building-the-random-forest"><i class="fa fa-check"></i>Exercise 3: Building the random forest</a></li>
<li class="chapter" data-level="" data-path="bagging-and-random-forests.html"><a href="bagging-and-random-forests.html#exercise-4-preliminary-interpretation"><i class="fa fa-check"></i>Exercise 4: Preliminary interpretation</a></li>
<li class="chapter" data-level="" data-path="bagging-and-random-forests.html"><a href="bagging-and-random-forests.html#exercise-5-evaluating-the-forest"><i class="fa fa-check"></i>Exercise 5: Evaluating the forest</a></li>
<li class="chapter" data-level="" data-path="bagging-and-random-forests.html"><a href="bagging-and-random-forests.html#exercise-6-variable-importance-measures"><i class="fa fa-check"></i>Exercise 6: Variable importance measures</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>V Unsupervised Learning</b></span></li>
<li class="chapter" data-level="14" data-path="k-means-clustering.html"><a href="k-means-clustering.html"><i class="fa fa-check"></i><b>14</b> K-Means Clustering</a>
<ul>
<li class="chapter" data-level="" data-path="k-means-clustering.html"><a href="k-means-clustering.html#learning-goals-12"><i class="fa fa-check"></i>Learning Goals</a></li>
<li class="chapter" data-level="" data-path="k-means-clustering.html"><a href="k-means-clustering.html#exercises-11"><i class="fa fa-check"></i>Exercises</a>
<ul>
<li class="chapter" data-level="" data-path="k-means-clustering.html"><a href="k-means-clustering.html#exercise-1-visual-explorations"><i class="fa fa-check"></i>Exercise 1: Visual explorations</a></li>
<li class="chapter" data-level="" data-path="k-means-clustering.html"><a href="k-means-clustering.html#exercise-2-k-means-clustering-on-bill-length-and-depth"><i class="fa fa-check"></i>Exercise 2: K-means clustering on bill length and depth</a></li>
<li class="chapter" data-level="" data-path="k-means-clustering.html"><a href="k-means-clustering.html#exercise-3-addressing-variable-scale"><i class="fa fa-check"></i>Exercise 3: Addressing variable scale</a></li>
<li class="chapter" data-level="" data-path="k-means-clustering.html"><a href="k-means-clustering.html#exercise-4-clustering-on-more-variables"><i class="fa fa-check"></i>Exercise 4: Clustering on more variables</a></li>
<li class="chapter" data-level="" data-path="k-means-clustering.html"><a href="k-means-clustering.html#exercise-5-interpreting-the-clusters"><i class="fa fa-check"></i>Exercise 5: Interpreting the clusters</a></li>
<li class="chapter" data-level="" data-path="k-means-clustering.html"><a href="k-means-clustering.html#exercise-6-picking-k"><i class="fa fa-check"></i>Exercise 6: Picking <span class="math inline">\(k\)</span></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="15" data-path="hierarchical-clustering.html"><a href="hierarchical-clustering.html"><i class="fa fa-check"></i><b>15</b> Hierarchical Clustering</a>
<ul>
<li class="chapter" data-level="" data-path="hierarchical-clustering.html"><a href="hierarchical-clustering.html#learning-goals-13"><i class="fa fa-check"></i>Learning Goals</a></li>
<li class="chapter" data-level="" data-path="hierarchical-clustering.html"><a href="hierarchical-clustering.html#exercises-12"><i class="fa fa-check"></i>Exercises</a>
<ul>
<li class="chapter" data-level="" data-path="hierarchical-clustering.html"><a href="hierarchical-clustering.html#exercise-1-hierarchical-clustering-by-hand"><i class="fa fa-check"></i>Exercise 1: Hierarchical clustering by hand</a></li>
<li class="chapter" data-level="" data-path="hierarchical-clustering.html"><a href="hierarchical-clustering.html#exercise-2-exploring-penguin-dendrograms"><i class="fa fa-check"></i>Exercise 2: Exploring penguin dendrograms</a></li>
<li class="chapter" data-level="" data-path="hierarchical-clustering.html"><a href="hierarchical-clustering.html#exercise-3-interpreting-the-clusters-visually"><i class="fa fa-check"></i>Exercise 3: Interpreting the clusters visually</a></li>
<li class="chapter" data-level="" data-path="hierarchical-clustering.html"><a href="hierarchical-clustering.html#exercise-4-tree-cutting-and-interpretation"><i class="fa fa-check"></i>Exercise 4: Tree-cutting and interpretation</a></li>
<li class="chapter" data-level="" data-path="hierarchical-clustering.html"><a href="hierarchical-clustering.html#exercise-5-k-means-vs.-hierarchical"><i class="fa fa-check"></i>Exercise 5: K-means vs. hierarchical</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="16" data-path="principal-components-analysis.html"><a href="principal-components-analysis.html"><i class="fa fa-check"></i><b>16</b> Principal Components Analysis</a>
<ul>
<li class="chapter" data-level="" data-path="principal-components-analysis.html"><a href="principal-components-analysis.html#learning-goals-14"><i class="fa fa-check"></i>Learning Goals</a></li>
<li class="chapter" data-level="" data-path="principal-components-analysis.html"><a href="principal-components-analysis.html#exercises-13"><i class="fa fa-check"></i>Exercises</a>
<ul>
<li class="chapter" data-level="" data-path="principal-components-analysis.html"><a href="principal-components-analysis.html#exercise-1-core-concepts"><i class="fa fa-check"></i>Exercise 1: Core concepts</a></li>
<li class="chapter" data-level="" data-path="principal-components-analysis.html"><a href="principal-components-analysis.html#exercise-2-exploring-pc-loadings"><i class="fa fa-check"></i>Exercise 2: Exploring PC loadings</a></li>
<li class="chapter" data-level="" data-path="principal-components-analysis.html"><a href="principal-components-analysis.html#exercise-3-exploring-pc-scores"><i class="fa fa-check"></i>Exercise 3: Exploring PC scores</a></li>
<li class="chapter" data-level="" data-path="principal-components-analysis.html"><a href="principal-components-analysis.html#exercise-4-scree-plots-and-dimension-reduction"><i class="fa fa-check"></i>Exercise 4: Scree plots and dimension reduction</a></li>
<li class="chapter" data-level="" data-path="principal-components-analysis.html"><a href="principal-components-analysis.html#exercise-5-variable-scaling"><i class="fa fa-check"></i>Exercise 5: Variable scaling</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>VI Homework</b></span></li>
<li class="chapter" data-level="" data-path="homework-1.html"><a href="homework-1.html"><i class="fa fa-check"></i>Homework 1</a>
<ul>
<li class="chapter" data-level="" data-path="homework-1.html"><a href="homework-1.html#project-work"><i class="fa fa-check"></i>Project Work</a></li>
<li class="chapter" data-level="" data-path="homework-1.html"><a href="homework-1.html#ethics-in-ml"><i class="fa fa-check"></i>Ethics in ML</a></li>
<li class="chapter" data-level="" data-path="homework-1.html"><a href="homework-1.html#portfolio-work"><i class="fa fa-check"></i>Portfolio Work</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="homework-2.html"><a href="homework-2.html"><i class="fa fa-check"></i>Homework 2</a>
<ul>
<li class="chapter" data-level="" data-path="homework-2.html"><a href="homework-2.html#project-work-1"><i class="fa fa-check"></i>Project Work</a></li>
<li class="chapter" data-level="" data-path="homework-2.html"><a href="homework-2.html#ethics-in-ml-1"><i class="fa fa-check"></i>Ethics in ML</a></li>
<li class="chapter" data-level="" data-path="homework-2.html"><a href="homework-2.html#portfolio-work-1"><i class="fa fa-check"></i>Portfolio Work</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="homework-3.html"><a href="homework-3.html"><i class="fa fa-check"></i>Homework 3</a>
<ul>
<li class="chapter" data-level="" data-path="homework-3.html"><a href="homework-3.html#project-work-2"><i class="fa fa-check"></i>Project Work</a>
<ul>
<li class="chapter" data-level="" data-path="homework-3.html"><a href="homework-3.html#note-this-is-a-repeat-of-hw2.-many-of-you-struggled-with-this-section-so-this-gives-you-an-opportunity-to-incorporate-feedback-from-the-preceptors-or-try-additional-models."><i class="fa fa-check"></i>Note: this is a repeat of HW2. Many of you struggled with this section, so this gives you an opportunity to incorporate feedback from the preceptors, or try additional models.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="homework-3.html"><a href="homework-3.html#portfolio-work-2"><i class="fa fa-check"></i>Portfolio Work</a></li>
<li class="chapter" data-level="" data-path="homework-3.html"><a href="homework-3.html#ethics-in-ml-2"><i class="fa fa-check"></i>Ethics in ML</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="homework-4.html"><a href="homework-4.html"><i class="fa fa-check"></i>Homework 4</a>
<ul>
<li class="chapter" data-level="" data-path="homework-4.html"><a href="homework-4.html#project-work-3"><i class="fa fa-check"></i>Project Work</a></li>
<li class="chapter" data-level="" data-path="homework-4.html"><a href="homework-4.html#ethics-in-ml-3"><i class="fa fa-check"></i>Ethics in ML</a></li>
<li class="chapter" data-level="" data-path="homework-4.html"><a href="homework-4.html#portfolio-work-3"><i class="fa fa-check"></i>Portfolio Work</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="homework-5.html"><a href="homework-5.html"><i class="fa fa-check"></i>Homework 5</a>
<ul>
<li class="chapter" data-level="" data-path="homework-5.html"><a href="homework-5.html#project-work-4"><i class="fa fa-check"></i>Project Work</a></li>
<li class="chapter" data-level="" data-path="homework-5.html"><a href="homework-5.html#ethics-in-ml-not-required"><i class="fa fa-check"></i>Ethics in ML (NOT REQUIRED)</a></li>
<li class="chapter" data-level="" data-path="homework-5.html"><a href="homework-5.html#portfolio-work-4"><i class="fa fa-check"></i>Portfolio Work</a></li>
</ul></li>
<li class="part"><span><b>VII Project</b></span></li>
<li class="chapter" data-level="" data-path="final-project.html"><a href="final-project.html"><i class="fa fa-check"></i>Final Project</a>
<ul>
<li class="chapter" data-level="" data-path="final-project.html"><a href="final-project.html#requirements"><i class="fa fa-check"></i>Requirements</a></li>
<li class="chapter" data-level="" data-path="final-project.html"><a href="final-project.html#grading-rubric"><i class="fa fa-check"></i>Grading Rubric</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="r-resources.html"><a href="r-resources.html"><i class="fa fa-check"></i>R Resources</a>
<ul>
<li class="chapter" data-level="" data-path="r-resources.html"><a href="r-resources.html#outside-resources"><i class="fa fa-check"></i>Outside resources</a></li>
<li class="chapter" data-level="" data-path="r-resources.html"><a href="r-resources.html#example-code"><i class="fa fa-check"></i>Example code</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://bookdown.org" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">STAT 253: Statistical Machine Learning</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="lasso-logistic-regression" class="section level1 hasAnchor" number="11">
<h1><span class="header-section-number">Topic 11</span> Lasso &amp; Logistic Regression<a href="lasso-logistic-regression.html#lasso-logistic-regression" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="learning-goals-9" class="section level2 unnumbered hasAnchor">
<h2>Learning Goals<a href="lasso-logistic-regression.html#learning-goals-9" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li>Describe how you can use LASSO for logistic regression model</li>
<li>Calculate (by hand from confusion matrices) and contextually interpret overall accuracy, sensitivity, and specificity</li>
<li>Construct and interpret plots of predicted probabilities across classes</li>
<li>Explain how a ROC curve is constructed and the rationale behind AUC as an evaluation metric</li>
<li>Appropriately use and interpret the no-information rate to evaluate accuracy metrics</li>
</ul>
<p><br></p>
<p><br><br><br></p>
</div>
<div id="lasso-for-logistic-regression-in-tidymodels" class="section level2 unnumbered hasAnchor">
<h2>LASSO for logistic regression in <code>tidymodels</code><a href="lasso-logistic-regression.html#lasso-for-logistic-regression-in-tidymodels" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>To build LASSO models for logistic regression in <code>tidymodels</code>, first load the package and set the seed for the random number generator to ensure reproducible results:</p>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb96-1"><a href="lasso-logistic-regression.html#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb96-2"><a href="lasso-logistic-regression.html#cb96-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb96-3"><a href="lasso-logistic-regression.html#cb96-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb96-4"><a href="lasso-logistic-regression.html#cb96-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidymodels)</span>
<span id="cb96-5"><a href="lasso-logistic-regression.html#cb96-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(probably) <span class="co">#install.packages(&#39;probably&#39;)</span></span>
<span id="cb96-6"><a href="lasso-logistic-regression.html#cb96-6" aria-hidden="true" tabindex="-1"></a><span class="fu">tidymodels_prefer</span>()</span>
<span id="cb96-7"><a href="lasso-logistic-regression.html#cb96-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-8"><a href="lasso-logistic-regression.html#cb96-8" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2023</span>) <span class="co"># or pick your favorite number to fill in the parentheses</span></span></code></pre></div>
<p><br><br><br></p>
</div>
<div id="exercises-9" class="section level2 unnumbered hasAnchor">
<h2>Exercises<a href="lasso-logistic-regression.html#exercises-9" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p><strong>You can download a template RMarkdown file to start from <a href="template_rmds/12-lasso-logistic.Rmd">here</a>.</strong></p>
<div id="context-3" class="section level3 unnumbered hasAnchor">
<h3>Context<a href="lasso-logistic-regression.html#context-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Before proceeding, install the <code>pROC</code> package (utilities for evaluating classification models with ROC curves) by entering <code>install.packages("pROC")</code> in the Console.</p>
<p>We’ll continue working with the <a href="https://archive.ics.uci.edu/ml/datasets/Spambase">spam dataset</a> from last time.</p>
<ul>
<li><code>spam</code>: Either <code>spam</code> or <code>not spam</code> (outcome)</li>
<li><code>word_freq_WORD</code>: percentage of words in the e-mail that match <code>WORD</code> (0-100)</li>
<li><code>char_freq_CHAR</code>: percentage of characters in the e-mail that match <code>CHAR</code> (e.g., exclamation points, dollar signs)</li>
<li><code>capital_run_length_average</code>: average length of uninterrupted sequences of capital letters</li>
<li><code>capital_run_length_longest</code>: length of longest uninterrupted sequence of capital letters</li>
<li><code>capital_run_length_total</code>: sum of length of uninterrupted sequences of capital letters</li>
</ul>
<p>Our goal will be to use email features to predict whether or not an email is spam - essentially, to build a spam filter!</p>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb97-1"><a href="lasso-logistic-regression.html#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb97-2"><a href="lasso-logistic-regression.html#cb97-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb97-3"><a href="lasso-logistic-regression.html#cb97-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb97-4"><a href="lasso-logistic-regression.html#cb97-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidymodels)</span>
<span id="cb97-5"><a href="lasso-logistic-regression.html#cb97-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(probably) <span class="co">#install.packages(&#39;probably&#39;)</span></span>
<span id="cb97-6"><a href="lasso-logistic-regression.html#cb97-6" aria-hidden="true" tabindex="-1"></a><span class="fu">tidymodels_prefer</span>()</span>
<span id="cb97-7"><a href="lasso-logistic-regression.html#cb97-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-8"><a href="lasso-logistic-regression.html#cb97-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-9"><a href="lasso-logistic-regression.html#cb97-9" aria-hidden="true" tabindex="-1"></a>spam <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;https://www.dropbox.com/s/leurr6a30f4l32a/spambase.csv?dl=1&quot;</span>)</span>
<span id="cb97-10"><a href="lasso-logistic-regression.html#cb97-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-11"><a href="lasso-logistic-regression.html#cb97-11" aria-hidden="true" tabindex="-1"></a><span class="co"># A little data cleaning to remove the space in &quot;not spam&quot;</span></span>
<span id="cb97-12"><a href="lasso-logistic-regression.html#cb97-12" aria-hidden="true" tabindex="-1"></a>spam <span class="ot">&lt;-</span> spam <span class="sc">%&gt;%</span></span>
<span id="cb97-13"><a href="lasso-logistic-regression.html#cb97-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">spam =</span> <span class="fu">ifelse</span>(spam<span class="sc">==</span><span class="st">&quot;spam&quot;</span>, <span class="st">&quot;spam&quot;</span>, <span class="st">&quot;not_spam&quot;</span>))</span></code></pre></div>
</div>
<div id="exercise-1-conceptual-warmup-1" class="section level3 unnumbered hasAnchor">
<h3>Exercise 1: Conceptual warmup<a href="lasso-logistic-regression.html#exercise-1-conceptual-warmup-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>LASSO for the logistic regression setting works analogously to the regression setting. How would you expect a plot of test <strong>roc_auc</strong> vs. <span class="math inline">\(\lambda\)</span> to look, and why?</p>
</div>
<div id="exercise-2-implementing-lasso-logistic-regression-in-tidymodels" class="section level3 unnumbered hasAnchor">
<h3>Exercise 2: Implementing LASSO logistic regression in <code>tidymodels</code><a href="lasso-logistic-regression.html#exercise-2-implementing-lasso-logistic-regression-in-tidymodels" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Fit a LASSO logistic regression model for the <code>spam</code> outcome, and allow all possible predictors to be considered (<code>~ .</code> in the model formula).</p>
<ul>
<li>Use 10-fold CV.</li>
<li>Initially try a sequence of 100 <span class="math inline">\(\lambda\)</span>’s from 1 to 10.
<ul>
<li>Diagnose whether this sequence should be updated by looking at the plot of test AUC vs. <span class="math inline">\(\lambda\)</span>.</li>
<li>If needed, adjust the max or min value in the sequence up or down by a factor of 10. (You’ll be able to determine from the plot whether to adjust up or down.)</li>
</ul></li>
</ul>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb98-1"><a href="lasso-logistic-regression.html#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb98-2"><a href="lasso-logistic-regression.html#cb98-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-3"><a href="lasso-logistic-regression.html#cb98-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Make sure you set reference level (to the outcome you are NOT interested in)</span></span>
<span id="cb98-4"><a href="lasso-logistic-regression.html#cb98-4" aria-hidden="true" tabindex="-1"></a>spam <span class="ot">&lt;-</span> spam <span class="sc">%&gt;%</span></span>
<span id="cb98-5"><a href="lasso-logistic-regression.html#cb98-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">spam =</span> <span class="fu">relevel</span>(<span class="fu">factor</span>(spam), <span class="at">ref=</span><span class="st">&#39;not_spam&#39;</span>)) <span class="co">#set reference level</span></span>
<span id="cb98-6"><a href="lasso-logistic-regression.html#cb98-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-7"><a href="lasso-logistic-regression.html#cb98-7" aria-hidden="true" tabindex="-1"></a>data_cv10 <span class="ot">&lt;-</span> <span class="fu">vfold_cv</span>(spam, <span class="at">v =</span> <span class="dv">10</span>)</span>
<span id="cb98-8"><a href="lasso-logistic-regression.html#cb98-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-9"><a href="lasso-logistic-regression.html#cb98-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-10"><a href="lasso-logistic-regression.html#cb98-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Logistic LASSO Regression Model Spec</span></span>
<span id="cb98-11"><a href="lasso-logistic-regression.html#cb98-11" aria-hidden="true" tabindex="-1"></a>logistic_lasso_spec_tune <span class="ot">&lt;-</span> <span class="fu">logistic_reg</span>() <span class="sc">%&gt;%</span></span>
<span id="cb98-12"><a href="lasso-logistic-regression.html#cb98-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">set_engine</span>(<span class="st">&#39;glmnet&#39;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb98-13"><a href="lasso-logistic-regression.html#cb98-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">set_args</span>(<span class="at">mixture =</span> <span class="dv">1</span>, <span class="at">penalty =</span> <span class="fu">tune</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb98-14"><a href="lasso-logistic-regression.html#cb98-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">set_mode</span>(<span class="st">&#39;classification&#39;</span>)</span>
<span id="cb98-15"><a href="lasso-logistic-regression.html#cb98-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-16"><a href="lasso-logistic-regression.html#cb98-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Recipe</span></span>
<span id="cb98-17"><a href="lasso-logistic-regression.html#cb98-17" aria-hidden="true" tabindex="-1"></a>logistic_rec <span class="ot">&lt;-</span> <span class="fu">recipe</span>(_____, <span class="at">data =</span> spam) <span class="sc">%&gt;%</span></span>
<span id="cb98-18"><a href="lasso-logistic-regression.html#cb98-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">step_normalize</span>(<span class="fu">all_numeric_predictors</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb98-19"><a href="lasso-logistic-regression.html#cb98-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">step_dummy</span>(<span class="fu">all_nominal_predictors</span>())</span>
<span id="cb98-20"><a href="lasso-logistic-regression.html#cb98-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-21"><a href="lasso-logistic-regression.html#cb98-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Workflow (Recipe + Model)</span></span>
<span id="cb98-22"><a href="lasso-logistic-regression.html#cb98-22" aria-hidden="true" tabindex="-1"></a>log_lasso_wf <span class="ot">&lt;-</span> <span class="fu">workflow</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb98-23"><a href="lasso-logistic-regression.html#cb98-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">add_recipe</span>(logistic_rec) <span class="sc">%&gt;%</span></span>
<span id="cb98-24"><a href="lasso-logistic-regression.html#cb98-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">add_model</span>(logistic_lasso_spec_tune) </span>
<span id="cb98-25"><a href="lasso-logistic-regression.html#cb98-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-26"><a href="lasso-logistic-regression.html#cb98-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Tune Model (trying a variety of values of Lambda penalty)</span></span>
<span id="cb98-27"><a href="lasso-logistic-regression.html#cb98-27" aria-hidden="true" tabindex="-1"></a>penalty_grid <span class="ot">&lt;-</span> <span class="fu">grid_regular</span>(</span>
<span id="cb98-28"><a href="lasso-logistic-regression.html#cb98-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">penalty</span>(<span class="at">range =</span> <span class="fu">c</span>(__,__)), <span class="co">#log10 transformed </span></span>
<span id="cb98-29"><a href="lasso-logistic-regression.html#cb98-29" aria-hidden="true" tabindex="-1"></a>  <span class="at">levels =</span> <span class="dv">100</span>)</span>
<span id="cb98-30"><a href="lasso-logistic-regression.html#cb98-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-31"><a href="lasso-logistic-regression.html#cb98-31" aria-hidden="true" tabindex="-1"></a>tune_output <span class="ot">&lt;-</span> <span class="fu">tune_grid</span>( </span>
<span id="cb98-32"><a href="lasso-logistic-regression.html#cb98-32" aria-hidden="true" tabindex="-1"></a>  log_lasso_wf, <span class="co"># workflow</span></span>
<span id="cb98-33"><a href="lasso-logistic-regression.html#cb98-33" aria-hidden="true" tabindex="-1"></a>  <span class="at">resamples =</span> data_cv10, <span class="co"># cv folds</span></span>
<span id="cb98-34"><a href="lasso-logistic-regression.html#cb98-34" aria-hidden="true" tabindex="-1"></a>  <span class="at">metrics =</span> <span class="fu">metric_set</span>(roc_auc,accuracy),</span>
<span id="cb98-35"><a href="lasso-logistic-regression.html#cb98-35" aria-hidden="true" tabindex="-1"></a>  <span class="at">control =</span> <span class="fu">control_resamples</span>(<span class="at">save_pred =</span> <span class="cn">TRUE</span>, <span class="at">event_level =</span> <span class="st">&#39;second&#39;</span>),</span>
<span id="cb98-36"><a href="lasso-logistic-regression.html#cb98-36" aria-hidden="true" tabindex="-1"></a>  <span class="at">grid =</span> penalty_grid <span class="co"># penalty grid defined above</span></span>
<span id="cb98-37"><a href="lasso-logistic-regression.html#cb98-37" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb98-38"><a href="lasso-logistic-regression.html#cb98-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-39"><a href="lasso-logistic-regression.html#cb98-39" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize Model Evaluation Metrics from Tuning</span></span>
<span id="cb98-40"><a href="lasso-logistic-regression.html#cb98-40" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(tune_output) <span class="sc">+</span> <span class="fu">theme_classic</span>()</span></code></pre></div>
</div>
<div id="exercise-3-inspecting-the-model" class="section level3 unnumbered hasAnchor">
<h3>Exercise 3: Inspecting the model<a href="lasso-logistic-regression.html#exercise-3-inspecting-the-model" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ol style="list-style-type: lower-alpha">
<li>Inspect the plot of CV AUC vs. <span class="math inline">\(\lambda\)</span> once more (after adjusting the penalty grid).</li>
</ol>
<p>Is anything surprising about the results relative to your expectations from Exercise 1? Brainstorm some possible explanations in consideration of the data context.</p>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb99-1"><a href="lasso-logistic-regression.html#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize Model Evaluation Metrics from Tuning</span></span>
<span id="cb99-2"><a href="lasso-logistic-regression.html#cb99-2" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(tune_output) <span class="sc">+</span> <span class="fu">theme_classic</span>()</span></code></pre></div>
<ol start="2" style="list-style-type: lower-alpha">
<li>Choose a final model whose CV AUC is within one standard error of the overall best metric. Comment on the variables that are removed from the model.</li>
</ol>
<div class="sourceCode" id="cb100"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb100-1"><a href="lasso-logistic-regression.html#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Select Penalty</span></span>
<span id="cb100-2"><a href="lasso-logistic-regression.html#cb100-2" aria-hidden="true" tabindex="-1"></a>best_se_penalty <span class="ot">&lt;-</span> <span class="fu">select_by_one_std_err</span>(tune_output, <span class="at">metric =</span> <span class="st">&#39;roc_auc&#39;</span>, <span class="fu">desc</span>(penalty)) <span class="co"># choose penalty value based on the largest penalty within 1 se of the highest CV roc_auc</span></span>
<span id="cb100-3"><a href="lasso-logistic-regression.html#cb100-3" aria-hidden="true" tabindex="-1"></a>best_se_penalty</span>
<span id="cb100-4"><a href="lasso-logistic-regression.html#cb100-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-5"><a href="lasso-logistic-regression.html#cb100-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit Final Model</span></span>
<span id="cb100-6"><a href="lasso-logistic-regression.html#cb100-6" aria-hidden="true" tabindex="-1"></a>final_fit_se <span class="ot">&lt;-</span> <span class="fu">finalize_workflow</span>(log_lasso_wf, best_se_penalty) <span class="sc">%&gt;%</span> <span class="co"># incorporates penalty value to workflow </span></span>
<span id="cb100-7"><a href="lasso-logistic-regression.html#cb100-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">fit</span>(<span class="at">data =</span> spam)</span>
<span id="cb100-8"><a href="lasso-logistic-regression.html#cb100-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-9"><a href="lasso-logistic-regression.html#cb100-9" aria-hidden="true" tabindex="-1"></a>final_fit_se <span class="sc">%&gt;%</span> <span class="fu">tidy</span>()</span></code></pre></div>
<ol start="3" style="list-style-type: lower-alpha">
<li>Compute the variable importance by how long it stayed in the model (with increasing <span class="math inline">\(\lambda\)</span>).</li>
</ol>
<div class="sourceCode" id="cb101"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb101-1"><a href="lasso-logistic-regression.html#cb101-1" aria-hidden="true" tabindex="-1"></a>glmnet_output <span class="ot">&lt;-</span> final_fit_se <span class="sc">%&gt;%</span> <span class="fu">extract_fit_engine</span>()</span>
<span id="cb101-2"><a href="lasso-logistic-regression.html#cb101-2" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb101-3"><a href="lasso-logistic-regression.html#cb101-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a boolean matrix (predictors x lambdas) of variable exclusion</span></span>
<span id="cb101-4"><a href="lasso-logistic-regression.html#cb101-4" aria-hidden="true" tabindex="-1"></a>bool_predictor_exclude <span class="ot">&lt;-</span> glmnet_output<span class="sc">$</span>beta<span class="sc">==</span><span class="dv">0</span></span>
<span id="cb101-5"><a href="lasso-logistic-regression.html#cb101-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-6"><a href="lasso-logistic-regression.html#cb101-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop over each variable</span></span>
<span id="cb101-7"><a href="lasso-logistic-regression.html#cb101-7" aria-hidden="true" tabindex="-1"></a>var_imp <span class="ot">&lt;-</span> <span class="fu">sapply</span>(<span class="fu">seq_len</span>(<span class="fu">nrow</span>(bool_predictor_exclude)), <span class="cf">function</span>(row) {</span>
<span id="cb101-8"><a href="lasso-logistic-regression.html#cb101-8" aria-hidden="true" tabindex="-1"></a>    this_coeff_path <span class="ot">&lt;-</span> bool_predictor_exclude[row,]</span>
<span id="cb101-9"><a href="lasso-logistic-regression.html#cb101-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">sum</span>(this_coeff_path) <span class="sc">==</span> <span class="fu">ncol</span>(bool_predictor_exclude)){ <span class="fu">return</span>(<span class="dv">0</span>)}<span class="cf">else</span>{</span>
<span id="cb101-10"><a href="lasso-logistic-regression.html#cb101-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">ncol</span>(bool_predictor_exclude) <span class="sc">-</span> <span class="fu">which.min</span>(this_coeff_path) <span class="sc">+</span> <span class="dv">1</span>)}</span>
<span id="cb101-11"><a href="lasso-logistic-regression.html#cb101-11" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb101-12"><a href="lasso-logistic-regression.html#cb101-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-13"><a href="lasso-logistic-regression.html#cb101-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a dataset of this information and sort</span></span>
<span id="cb101-14"><a href="lasso-logistic-regression.html#cb101-14" aria-hidden="true" tabindex="-1"></a>var_imp_data <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb101-15"><a href="lasso-logistic-regression.html#cb101-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">var_name =</span> <span class="fu">rownames</span>(bool_predictor_exclude),</span>
<span id="cb101-16"><a href="lasso-logistic-regression.html#cb101-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">var_imp =</span> var_imp</span>
<span id="cb101-17"><a href="lasso-logistic-regression.html#cb101-17" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb101-18"><a href="lasso-logistic-regression.html#cb101-18" aria-hidden="true" tabindex="-1"></a>var_imp_data <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(<span class="fu">desc</span>(var_imp))</span></code></pre></div>
</div>
<div id="exercise-4-interpreting-evaluation-metrics" class="section level3 unnumbered hasAnchor">
<h3>Exercise 4: Interpreting evaluation metrics<a href="lasso-logistic-regression.html#exercise-4-interpreting-evaluation-metrics" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Inspect the overall CV results for the “best” <span class="math inline">\(\lambda\)</span>, and compute the no-information rate (NIR):</p>
<div class="sourceCode" id="cb102"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb102-1"><a href="lasso-logistic-regression.html#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="co"># CV results for &quot;best lambda&quot;</span></span>
<span id="cb102-2"><a href="lasso-logistic-regression.html#cb102-2" aria-hidden="true" tabindex="-1"></a>tune_output <span class="sc">%&gt;%</span></span>
<span id="cb102-3"><a href="lasso-logistic-regression.html#cb102-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">collect_metrics</span>() <span class="sc">%&gt;%</span></span>
<span id="cb102-4"><a href="lasso-logistic-regression.html#cb102-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(penalty <span class="sc">==</span> best_se_penalty <span class="sc">%&gt;%</span> <span class="fu">pull</span>(penalty))</span>
<span id="cb102-5"><a href="lasso-logistic-regression.html#cb102-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-6"><a href="lasso-logistic-regression.html#cb102-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Count up number of spam and not_spam emails in the training data</span></span>
<span id="cb102-7"><a href="lasso-logistic-regression.html#cb102-7" aria-hidden="true" tabindex="-1"></a>spam <span class="sc">%&gt;%</span></span>
<span id="cb102-8"><a href="lasso-logistic-regression.html#cb102-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">count</span>(spam) <span class="co"># Name of the outcome variable goes inside count()</span></span>
<span id="cb102-9"><a href="lasso-logistic-regression.html#cb102-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-10"><a href="lasso-logistic-regression.html#cb102-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the NIR</span></span></code></pre></div>
<ul>
<li>Why is an AUC of 1 the best possible value for this metric? How does the AUC for our spam model look relative to this best value?</li>
</ul>
</div>
<div id="exercise-5-using-the-final-model-choosing-a-threshold" class="section level3 unnumbered hasAnchor">
<h3>Exercise 5: Using the final model (choosing a threshold)<a href="lasso-logistic-regression.html#exercise-5-using-the-final-model-choosing-a-threshold" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Once we’ve used LASSO to do model selection (to balance bias and variance), we need to use the final model to make predictions.</p>
<div class="sourceCode" id="cb103"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb103-1"><a href="lasso-logistic-regression.html#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Soft Predictions on Training Data</span></span>
<span id="cb103-2"><a href="lasso-logistic-regression.html#cb103-2" aria-hidden="true" tabindex="-1"></a>final_output <span class="ot">&lt;-</span> final_fit_se <span class="sc">%&gt;%</span> <span class="fu">predict</span>(<span class="at">new_data =</span> spam, <span class="at">type=</span><span class="st">&#39;prob&#39;</span>) <span class="sc">%&gt;%</span> <span class="fu">bind_cols</span>(spam)</span></code></pre></div>
<ol style="list-style-type: lower-alpha">
<li>Make an ROC curve of the sensitivity and specificity for the final model. First, consider sensitivity and specificity - what do these numbers mean? Do you think higher sensitivity or specificity would be more important in designing a spam filter? Comment about the shape of the ROC curve and what that tells you about the model.</li>
</ol>
<div class="sourceCode" id="cb104"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb104-1"><a href="lasso-logistic-regression.html#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Use soft predictions</span></span>
<span id="cb104-2"><a href="lasso-logistic-regression.html#cb104-2" aria-hidden="true" tabindex="-1"></a>final_output <span class="sc">%&gt;%</span></span>
<span id="cb104-3"><a href="lasso-logistic-regression.html#cb104-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">roc_curve</span>(spam,.pred_spam,<span class="at">event_level =</span> <span class="st">&#39;second&#39;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb104-4"><a href="lasso-logistic-regression.html#cb104-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">autoplot</span>()</span></code></pre></div>
<ol start="2" style="list-style-type: lower-alpha">
<li>Similar to the ROC curve, we can calculate the sensitivity and specificity for a variety of threshold values. Then we will calculate two measures.</li>
</ol>
<ul>
<li>J index: sensitivity + specificity - 1</li>
<li>distance (Euclidean distance to [false positive = 0, sens = 1]): (1 - sensitivity) ^ 2 + (1 - specificity) ^ 2</li>
</ul>
<p>We can use these measures to help us choose an optimal threshold.</p>
<div class="sourceCode" id="cb105"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb105-1"><a href="lasso-logistic-regression.html#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="co"># thresholds in terms of reference level</span></span>
<span id="cb105-2"><a href="lasso-logistic-regression.html#cb105-2" aria-hidden="true" tabindex="-1"></a>threshold_output <span class="ot">&lt;-</span> final_output <span class="sc">%&gt;%</span></span>
<span id="cb105-3"><a href="lasso-logistic-regression.html#cb105-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">threshold_perf</span>(<span class="at">truth =</span> spam, <span class="at">estimate =</span> .pred_not_spam, <span class="at">thresholds =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="at">by=</span>.<span class="dv">01</span>)) </span>
<span id="cb105-4"><a href="lasso-logistic-regression.html#cb105-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-5"><a href="lasso-logistic-regression.html#cb105-5" aria-hidden="true" tabindex="-1"></a><span class="co"># J-index v. threshold for not_spam</span></span>
<span id="cb105-6"><a href="lasso-logistic-regression.html#cb105-6" aria-hidden="true" tabindex="-1"></a>threshold_output <span class="sc">%&gt;%</span></span>
<span id="cb105-7"><a href="lasso-logistic-regression.html#cb105-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(.metric <span class="sc">==</span> <span class="st">&#39;j_index&#39;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb105-8"><a href="lasso-logistic-regression.html#cb105-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> .threshold, <span class="at">y =</span> .estimate)) <span class="sc">+</span></span>
<span id="cb105-9"><a href="lasso-logistic-regression.html#cb105-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb105-10"><a href="lasso-logistic-regression.html#cb105-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&#39;J-index&#39;</span>, <span class="at">x =</span> <span class="st">&#39;threshold&#39;</span>) <span class="sc">+</span></span>
<span id="cb105-11"><a href="lasso-logistic-regression.html#cb105-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_classic</span>()</span>
<span id="cb105-12"><a href="lasso-logistic-regression.html#cb105-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-13"><a href="lasso-logistic-regression.html#cb105-13" aria-hidden="true" tabindex="-1"></a>threshold_output <span class="sc">%&gt;%</span></span>
<span id="cb105-14"><a href="lasso-logistic-regression.html#cb105-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(.metric <span class="sc">==</span> <span class="st">&#39;j_index&#39;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb105-15"><a href="lasso-logistic-regression.html#cb105-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(<span class="fu">desc</span>(.estimate))</span>
<span id="cb105-16"><a href="lasso-logistic-regression.html#cb105-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-17"><a href="lasso-logistic-regression.html#cb105-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-18"><a href="lasso-logistic-regression.html#cb105-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Distance v. threshold for not_spam</span></span>
<span id="cb105-19"><a href="lasso-logistic-regression.html#cb105-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-20"><a href="lasso-logistic-regression.html#cb105-20" aria-hidden="true" tabindex="-1"></a>threshold_output <span class="sc">%&gt;%</span></span>
<span id="cb105-21"><a href="lasso-logistic-regression.html#cb105-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(.metric <span class="sc">==</span> <span class="st">&#39;distance&#39;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb105-22"><a href="lasso-logistic-regression.html#cb105-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> .threshold, <span class="at">y =</span> .estimate)) <span class="sc">+</span></span>
<span id="cb105-23"><a href="lasso-logistic-regression.html#cb105-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb105-24"><a href="lasso-logistic-regression.html#cb105-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&#39;Distance&#39;</span>, <span class="at">x =</span> <span class="st">&#39;threshold&#39;</span>) <span class="sc">+</span></span>
<span id="cb105-25"><a href="lasso-logistic-regression.html#cb105-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_classic</span>()</span>
<span id="cb105-26"><a href="lasso-logistic-regression.html#cb105-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-27"><a href="lasso-logistic-regression.html#cb105-27" aria-hidden="true" tabindex="-1"></a>threshold_output <span class="sc">%&gt;%</span></span>
<span id="cb105-28"><a href="lasso-logistic-regression.html#cb105-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(.metric <span class="sc">==</span> <span class="st">&#39;distance&#39;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb105-29"><a href="lasso-logistic-regression.html#cb105-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(.estimate)</span>
<span id="cb105-30"><a href="lasso-logistic-regression.html#cb105-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-31"><a href="lasso-logistic-regression.html#cb105-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-32"><a href="lasso-logistic-regression.html#cb105-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-33"><a href="lasso-logistic-regression.html#cb105-33" aria-hidden="true" tabindex="-1"></a>log_metrics <span class="ot">&lt;-</span> <span class="fu">metric_set</span>(accuracy,sens,yardstick<span class="sc">::</span>spec)</span>
<span id="cb105-34"><a href="lasso-logistic-regression.html#cb105-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-35"><a href="lasso-logistic-regression.html#cb105-35" aria-hidden="true" tabindex="-1"></a>final_output <span class="sc">%&gt;%</span></span>
<span id="cb105-36"><a href="lasso-logistic-regression.html#cb105-36" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">.pred_class =</span> <span class="fu">make_two_class_pred</span>(.pred_not_spam, <span class="fu">levels</span>(spam), <span class="at">threshold =</span> ___ )) <span class="sc">%&gt;%</span></span>
<span id="cb105-37"><a href="lasso-logistic-regression.html#cb105-37" aria-hidden="true" tabindex="-1"></a>    <span class="fu">log_metrics</span>(<span class="at">truth =</span> spam, <span class="at">estimate =</span> .pred_class, <span class="at">event_level =</span> <span class="st">&#39;second&#39;</span>)</span></code></pre></div>
<p>Choose a threshold and interpret overall accuracy - does this seem high? How can the no-information rate (NIR) help us interpret the overall accuracy?</p>
<ol start="3" style="list-style-type: lower-alpha">
<li>There are data contexts in which you might want to weigh the relative cost of a false negative to a false positive and incorporate that into your choice of threshold.</li>
</ol>
<p>In this case you can specify:</p>
<ul>
<li><span class="math inline">\(cost\)</span>, the relative cost of a false negative classification (as compared with a false positive classification)</li>
<li><span class="math inline">\(prev\)</span>, the prevalence, or the proportion of positive cases in the population</li>
</ul>
<p>and calculate</p>
<p><span class="math display">\[r = \frac{1-prev}{cost*prev}\]</span>
This value <span class="math inline">\(r\)</span> gives a measure of the relative cost of false positives to false negatives, weighting by the frequency of the two groups. If <span class="math inline">\(cost = 1\)</span> and <span class="math inline">\(prev = 0.5\)</span>, <span class="math inline">\(r=1\)</span>.</p>
<p>Then we can update our two measures,</p>
<ul>
<li>Weighted J index: sensitivity + r*specificity - 1</li>
<li>Weighted distance: (1 - sensitivity) ^ 2 + r*(1 - specificity) ^ 2</li>
</ul>
<p><strong>Computational Thinking Exercise</strong>: If you were to implement these weighted measures (j-index and distance), how would you go about using the following ROC output to calculate the measures and find the optimal threshold. Write our the steps in words using the names of functions you might use, but don’t actually code it up.</p>
<div class="sourceCode" id="cb106"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb106-1"><a href="lasso-logistic-regression.html#cb106-1" aria-hidden="true" tabindex="-1"></a>final_output <span class="sc">%&gt;%</span></span>
<span id="cb106-2"><a href="lasso-logistic-regression.html#cb106-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">roc_curve</span>(spam,.pred_spam,<span class="at">event_level =</span> <span class="st">&#39;second&#39;</span>)</span></code></pre></div>
</div>
<div id="exercise-6-algorithmic-understanding-for-evaluation-metrics" class="section level3 unnumbered hasAnchor">
<h3>Exercise 6: Algorithmic understanding for evaluation metrics<a href="lasso-logistic-regression.html#exercise-6-algorithmic-understanding-for-evaluation-metrics" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Inspect the iteration specific information from tuning the LASSO model (focus on the “best” penalty term).</p>
<div class="sourceCode" id="cb107"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb107-1"><a href="lasso-logistic-regression.html#cb107-1" aria-hidden="true" tabindex="-1"></a>tune_output <span class="sc">%&gt;%</span> <span class="fu">collect_metrics</span>(<span class="at">summarize =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(penalty <span class="sc">==</span> best_se_penalty <span class="sc">%&gt;%</span> <span class="fu">pull</span>(penalty))</span></code></pre></div>
<p>How is one row of information computed? Carefully describe (in words) the CV process for a single iteration to estimate each of CV <code>roc_auc</code> and <code>accuracy</code> (overall accuracy). Use a generic confusion matrix (filled with TP, TP, FP, FN instead of hard numbers) to illustrate the underlying computations.</p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="logistic-regression.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="decision-trees.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": false,
"twitter": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
